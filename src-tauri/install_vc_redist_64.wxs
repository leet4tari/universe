<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

    <!-- https://github.com/tauri-apps/tauri/issues/5442 -->

        <util:RegistrySearch Root="HKLM"
            Key="SOFTWARE\Microsoft\VisualStudio\14.0\VC\Runtimes\X64"
            Variable="CPP14RedistBld"
            Value="Bld"
            Result="value"
            Win64="yes"/>
        <WixVariable Id="CPP14DetectCondition" Overridable="yes" Value="CPP14RedistBld &gt;= 30040" />
        <PackageGroup Id="redist_vc15to19">
            <ExePackage Id="vc14" Cache="no" PerMachine="yes" Vital="yes" Compressed="no" Permanent="yes"
                Name="vc_redist.x64.exe"
                DownloadUrl="https://download.visualstudio.microsoft.com/download/pr/888b4c07-c602-499a-9efb-411188496ce7/F3A86393234099BEDD558FD35AB538A6E4D9D4F99AD5ADFA13F603D4FF8A42DC/VC_redist.x86.exe"
                InstallCommand="/quiet /norestart"
                DetectCondition="!(wix.CPP14DetectCondition)">
                <RemotePayload 
                    Size="25169400"
                    Version="14.29.30040.0"
                    ProductName="Microsoft Visual C++ 2015-2019 Redistributable (x64) - 14.28.29914"
                    Description="Microsoft Visual C++ 2015-2019 Redistributable (x64) - 14.28.29914"
                    Hash="9ADE54D322BE27BFF05D5AFEC8ED44F9B2D9306E" />
                <ExitCode Value="1638" Behavior="success"/> <!-- Don't fail if newer version is installed -->
            </ExePackage>
        </PackageGroup>
    </Fragment>
</Wix>
